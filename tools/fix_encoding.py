#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä¿®å¤PMCçŠ¶æ€æŸ¥çœ‹å™¨çš„ç¼–ç é—®é¢˜
å°†emojiå­—ç¬¦æ›¿æ¢ä¸ºWindowså‘½ä»¤è¡Œå…¼å®¹çš„æ–‡æœ¬
"""

import re
from pathlib import Path

def fix_pmc_status_viewer():
    """ä¿®å¤pmc_status_viewer.pyçš„ç¼–ç é—®é¢˜"""
    file_path = Path("s:/PG-PMC/tools/pmc_status_viewer.py")
    
    # emojiæ›¿æ¢æ˜ å°„
    emoji_replacements = {
        'ğŸ­': '[å·¥å‚]',
        'ğŸ“‹': '[æ¸…å•]',
        'ğŸ–¥ï¸': '[ç³»ç»Ÿ]',
        'ğŸ”„': '[è¿è¡Œ]',
        'â°': '[æ—¶é—´]',
        'ğŸ“¦': '[ç‰ˆæœ¬]',
        'ğŸ”§': '[æ¨¡å—]',
        'ğŸ“Š': '[æ•°æ®]',
        'âœ…': '[æ­£å¸¸]',
        'ğŸš¨': '[é¢„è­¦]',
        'ğŸ“': '[è§„åˆ™]',
        'â³': '[å¾…å¤„ç†]',
        'ğŸ“ˆ': '[ä»ªè¡¨æ¿]',
        'ğŸ‘ï¸': '[ç›‘æ§]',
        'ğŸŒ…': '[å¯åŠ¨]',
        'ğŸ”': '[æ£€æŸ¥]',
        'ğŸ¯': '[é‡ç‚¹]',
        'ğŸ”¥': '[ç´§æ€¥]',
        'ğŸ“…': '[æ—¥å¸¸]',
        'ğŸ’Š': '[å¥åº·]',
        'ğŸ¥': '[æ•´ä½“]',
        'ğŸ’»': '[CPU]',
        'ğŸ§ ': '[å†…å­˜]',
        'ğŸ’¾': '[ç£ç›˜]',
        'ğŸŒ': '[ç½‘ç»œ]',
        'âŒ': '[å¼‚å¸¸]',
        'âš ï¸': '[æ³¨æ„]',
        'ğŸ“': '[æ–‡ä»¶]',
        'ğŸ“': '[ä½ç½®]',
        'ğŸ˜´': '[ä¼‘çœ ]',
        'ğŸŸ¢': '[åœ¨çº¿]',
        'ğŸ”´': '[ç¦»çº¿]',
        'ğŸ“¡': '[æ•°æ®æº]',
        'ğŸ‘¥': '[å›¢é˜Ÿ]',
        'ğŸ‘¤': '[æˆå‘˜]',
        'ğŸš€': '[å¯åŠ¨]',
        'ğŸ‰': '[å®Œæˆ]',
        'ğŸ“–': '[æ‰‹å†Œ]',
        'ğŸ“š': '[æ–‡æ¡£]',
        'ğŸ”—': '[é“¾æ¥]',
        'ğŸ’¡': '[æç¤º]',
        'ğŸ› ï¸': '[å·¥å…·]',
        'âš™ï¸': '[è®¾ç½®]',
        'ğŸ”’': '[å®‰å…¨]',
        'ğŸ”“': '[å¼€æ”¾]',
        'ğŸ“': '[è®°å½•]',
        'ğŸ“„': '[æ–‡æ¡£]',
        'ğŸ“Š': '[å›¾è¡¨]',
        'ğŸ“ˆ': '[è¶‹åŠ¿]',
        'ğŸ“‰': '[ä¸‹é™]',
        'ğŸ””': '[é€šçŸ¥]',
        'ğŸ”•': '[é™éŸ³]',
        'â­': '[é‡è¦]',
        'ğŸŒŸ': '[äº®ç‚¹]',
        'ğŸ’¯': '[å®Œç¾]',
        'ğŸŠ': '[åº†ç¥]'
    }
    
    try:
        # è¯»å–æ–‡ä»¶å†…å®¹
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # æ›¿æ¢emoji
        for emoji, replacement in emoji_replacements.items():
            content = content.replace(emoji, replacement)
        
        # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢æ‰€æœ‰å‰©ä½™çš„emojiå­—ç¬¦
        # åŒ¹é…Unicode emojièŒƒå›´
        emoji_pattern = re.compile(
            r'[\U0001F600-\U0001F64F]|'  # è¡¨æƒ…ç¬¦å·
            r'[\U0001F300-\U0001F5FF]|'  # ç¬¦å·å’Œè±¡å½¢æ–‡å­—
            r'[\U0001F680-\U0001F6FF]|'  # äº¤é€šå’Œåœ°å›¾ç¬¦å·
            r'[\U0001F1E0-\U0001F1FF]|'  # å›½æ——
            r'[\U00002600-\U000026FF]|'  # æ‚é¡¹ç¬¦å·
            r'[\U00002700-\U000027BF]|'  # è£…é¥°ç¬¦å·
            r'[\U0001F900-\U0001F9FF]|'  # è¡¥å……ç¬¦å·å’Œè±¡å½¢æ–‡å­—
            r'[\U0001FA70-\U0001FAFF]'   # æ‰©å±•Aç¬¦å·å’Œè±¡å½¢æ–‡å­—
        )
        
        def replace_emoji(match):
            return '[ç¬¦å·]'
        
        content = emoji_pattern.sub(replace_emoji, content)
        
        # å†™å›æ–‡ä»¶
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("âœ… pmc_status_viewer.py ç¼–ç é—®é¢˜å·²ä¿®å¤")
        return True
        
    except Exception as e:
        print(f"âŒ ä¿®å¤å¤±è´¥: {e}")
        return False

def main():
    """ä¸»å‡½æ•°"""
    print("ğŸ”§ å¼€å§‹ä¿®å¤PMCçŠ¶æ€æŸ¥çœ‹å™¨ç¼–ç é—®é¢˜...")
    
    if fix_pmc_status_viewer():
        print("ğŸ‰ ç¼–ç é—®é¢˜ä¿®å¤å®Œæˆï¼")
        print("ğŸ“‹ ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨PMCæ§åˆ¶é¢æ¿äº†")
        return 0
    else:
        print("âŒ ä¿®å¤å¤±è´¥")
        return 1

if __name__ == "__main__":
    exit(main())