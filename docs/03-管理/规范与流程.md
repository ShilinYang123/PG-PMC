# 仔细、仔细、再仔细，严谨、严谨、再严谨

---

# PMC全流程图表界面应用软件项目规范与流程

本文档基于《项目架构设计.md》制定，旨在明确PMC全流程图表界面应用软件开发过程中的各项标准与流程，确保开发工作有序、高效进行，提升项目的可维护性与协作性。

## 项目概述

PMC全流程图表界面应用软件是一个基于人工智能和自然语言处理技术的智能生产管理平台，专门为小家电制造企业设计。系统基于BD400原始订单表和现有PMC工作流程，开发一套完整的图表界面PMC管理应用软件，实现从订单接收到产品交付的全流程可视化管理，集成微信、手机、邮件的自动跟进与催办功能。

### 项目存储位置
- **开发软件存储**：S:\PG-PMC\project
- **项目数据位置**：S:\PG-PMC\AI调度表

### 技术愿景
- **可视化优先**：以图表界面为核心，提供直观的数据展示和操作体验
- **全流程覆盖**：从订单接收到产品交付的完整业务流程支持
- **智能催办**：集成多渠道自动跟进催办，提升工作效率
- **实时监控**：实时数据更新和状态监控，及时发现和处理异常
- **协同工作**：支持多部门协作的统一工作平台

### 架构原则
- **前端优先**：重点投入前端图表界面开发，提供优秀的用户体验
- **数据驱动**：以订单数据为核心，构建完整的数据流转体系
- **模块化设计**：采用组件化开发，各功能模块独立开发和维护
- **集成友好**：支持与现有系统的集成，降低实施成本
- **响应式设计**：支持PC端和移动端的响应式访问

## 目录

### 核心管理规范
1. [开发角色与工具使用规则](#一开发角色与工具使用规则) - 明确角色定义、对话规范、工具使用要求
2. [权限管理规定](#二权限管理规定) - 核心文档操作权限、核心脚本保护权限、目录结构管理权限
3. [工作前准备流程](#三工作前准备流程) - 任务目标、技术路径、环境检查等5个步骤
4. [工作结束事项](#四工作结束事项) - 代码检查、测试、提交、文档更新等8项要求
5. [GitHub仓库结构规范](#五github仓库结构规范) - 仓库组织和提交规范
6. [目录文件及清单管理规定](#六目录文件及清单管理规定) - 目录结构标准和管理工具使用
7. [命名规范](#七命名规范) - 通用原则和各类元素的具体命名规则

### 技术开发规范
8. [开发流程规范](#八开发流程规范) - Git工作流程、分支管理、提交规范、代码审查
9. [开发环境规范](#九开发环境规范) - 环境要求、编辑器配置、依赖管理
10. [代码规范](#十代码规范) - 命名规范、代码风格、注释规范（Python）
11. [测试规范](#十一测试规范) - 测试策略、覆盖率要求、测试用例结构
12. [配置管理规范](#十二配置管理规范) - 配置体系架构、环境管理、配置验证
13. [API设计规范](#十三api设计规范) - RESTful设计、版本控制、认证授权、监控日志

## 第一章 开发角色与工具使用规则

### 1. 角色定义

*   **杨老师**：编程基础薄弱，非专业技术人员，负责提出项目需求。
*   **雨俊**：资深软件专家，担任项目技术负责人，负责项目实施计划制定、开发执行及测试工作 。

### 2. 开发者角色定义

#### 技术负责人（Tech Lead）
- **职责**：项目整体技术架构设计、关键技术决策、代码审查、图表界面设计指导
- **权限**：所有代码库访问权限、分支管理权限、发布权限
- **工具使用**：可使用所有MCP工具，包括TaskManager、sequential-thinking、context7、memory等
- **专业领域**：PMC全流程业务理解、图表界面设计、系统集成

#### 前端开发者（Frontend Developer）
- **职责**：图表界面开发、用户体验优化、响应式设计、组件库维护
- **权限**：前端代码库完全访问权限、UI/UX相关分支管理权限
- **工具使用**：可使用TaskManager、sequential-thinking、context7等开发工具
- **专业领域**：React、TypeScript、Ant Design、ECharts、响应式设计

#### 后端开发者（Backend Developer）
- **职责**：API开发、数据库设计、业务逻辑实现、系统集成
- **权限**：后端代码库完全访问权限、数据库管理权限
- **工具使用**：可使用TaskManager、sequential-thinking、context7等开发工具
- **专业领域**：FastAPI、PostgreSQL、Redis、Excel兼容性、第三方集成

#### 全栈开发者（Full-stack Developer）
- **职责**：前后端功能开发、接口联调、端到端测试
- **权限**：指定模块前后端代码库访问权限、功能分支创建权限
- **工具使用**：可使用基础开发工具，需申请使用高级MCP工具
- **专业领域**：PMC业务流程、数据可视化、系统集成

### 3. 对话规范

与杨老师沟通时，每次对话开头需以 "杨老师" 称呼。（本条以实时检测Agent是否遗忘规则）

### 3. 工具使用要求

| 工具名称                  | 功能用途                      |
| -------------------------- | ------------------------------ |
| TaskManager           | 任务分解，将复杂任务拆解为可执行子任务       |
| sequential - thinking | 辅助逻辑推理，理清开发思路与流程          |
| context7              | 查询技术与知识文档，获取开发所需资料        |
| memory                | 增强项目内容记忆与理解，便于快速调用相关信息    |
| flake8                | 梳理并修正代码错误，保证代码质量          |
| desktop - commander   | 自动执行终端命令操作，提高开发效率         |
|                            | 秉持 YOLO 模式精神，主动、自动化执行各项任务 |

### 4. 工作流程规范

*   当对话上下文长度接近系统限制时，及时将重要内容存入 memory。
*   每日工作结束，严格执行自检流程，列举当日工作内容并对照项目规范检查。

### 5. 文档命名规则

所有文档统一使用中文命名，确保名称清晰表意。

### 6. 代码验证要求

每次完成或修改代码后，自行运行代码，并使用 flake8、eslint、playwright 等工具检测验证，确保代码质量达标。

## 第二章 文件权限管理规范

### 1. 核心文件权限控制原则

以下核心文档必须设置为只读状态，修改需要获得杨老师的明确授权：

**设计文档类（🔒 只读）：**
- `docs\01-设计\开发任务书.md` - 需要杨老师授权
- `docs\01-设计\技术方案.md` - 需要杨老师授权
- `docs\01-设计\项目架构设计.md` - 需要杨老师授权
- `docs\01-设计\目录结构标准清单.md` - 需要杨老师授权。
在杨老师授权同意后，用`tools\update_structure.py`生成，范围为"{{paths.root}}\"全部内容，其中：
（1）`\bak\`下只包括`\bak\github_repo`、`\bak\迁移备份`、`\bak\专项备份`、`\bak\待清理资料`、`\bak\常规备份` 5个子目录名，排除其所有具体备份文件；
（2）`\logs\`下只包括`\logs\工作记录`、`\logs\检查报告`、`\logs\其他日志`、`\logs\archive` 4个子目录名，排除其所有具体记录文件。

**管理规范类（🔒 只读）：**
- `docs\03-管理\规范与流程.md` - 需要杨老师授权
- `docs\03-管理\project_config.yaml` - 需要杨老师授权
- `docs\03-管理\.env` - 需要杨老师授权
- `docs\03-管理\.env.example` - 需要杨老师授权

**核心工具脚本（🔒 只读）：**
- `tools\finish.py` - 需要杨老师授权
- `tools\control.py` - 需要杨老师授权
- `tools\check_structure.py` - 目录结构合规性检查脚本- 必须经杨老师授权才能修改
- `tools\update_structure.py` - 合规的《目录结构标准清单.md》 生成脚本- 必须经杨老师授权才能修改

### 2. 权限控制原则

*   **最小权限原则**：仅在必要时申请和使用相应权限；
*   **审批记录**：所有权限申请和批准过程需要有明确记录；
*   **责任追溯**：确保每个操作都有明确的责任人和授权依据；
*   **权限状态管理**：核心文件默认保持只读状态，仅在获得授权后临时解锁。

### 3. 权限控制脚本使用

**工具路径**：`tools\control.py`

**使用场景**：
*   需要修改核心文档或脚本文件时；
*   工作结束后恢复文件只读保护状态时；
*   检查当前文件权限状态时。

**操作流程**：
1. 获得杨老师明确授权后，运行 `python tools\control.py`
2. 选择相应操作（设置只读\可写\检查状态）
3. 脚本会自动备份文件到 `bak\专项备份\` 目录，取名"权限变更备份"加时间戳
4. 完成必要修改后，及时恢复文件只读状态

## 第三章 工作准备流程

### 1. 明确任务目标

*   仔细研读 "{{paths.docs_dir}}\01-设计\开发任务书.md"。
*   结合当前任务看板，精准把握本次工作核心目标和交付成果。

### 2. 规划技术路径

*   参考 "{{paths.docs_dir}}\01-设计\技术方案.md"。
*   基于项目现有技术架构，制定详细技术实施方案与步骤。

### 3. 检查开发环境

#### （1）本地环境配置

*   确认 VS Code Dev Container、Docker 服务等已正确配置且运行正常。
*   检查并安装项目所需相关依赖组件，确保开发环境完整。

#### （2）MCP 工具检查

*   测试 desktop - commander、sequential - thinking、TaskManager、memory 等工具可用性。
*   数据存储路径禁止通过编码设置，而是通过配置文件及变量文件设置为：
    *   TaskManager 存储路径："项目根目录 \docs\02 - 开发 \tasks.json"
*   memory 存储路径："项目根目录 \docs\02 - 开发 \memory.json"

#### （3）代码辅助工具

检查 flake8、eslint 等代码检查工具能否正常使用，保障代码检查工作顺利开展。

### 4. 同步最新代码

**Git仓库目录**：`{{PROJECT_ROOT}}\bak\github_repo`

从代码仓库拉取最新代码，避免基于过旧版本开发，确保开发内容时效性。

### 5. 回顾相关文档

查阅与任务相关设计文档、API 文档、模块说明等，充分了解项目背景与技术细节，为开发工作奠定基础。

## 四、工作结束事项

### 1. 代码质量检查

运行 flake8、eslint 等代码质量检查工具，记录检查结果并及时修复问题，保证代码质量达标。

### 2. 自动化测试

执行单元测试和集成测试，确保测试覆盖率满足项目要求，验证系统功能稳定性与可靠性。

### 3. 功能自测

对完成功能进行基本自测，对照需求规格验证功能是否正确实现，及时发现并解决功能缺陷。

### 4. 代码提交

将当日完成或有进展的代码全部提交到 Git 仓库`{{PROJECT_ROOT}}\bak\github_repo`，遵循提交规范，编写清晰、准确提交说明，方便后续追溯与协作。

### 5. 文档更新

更新开发日志、技术方案、目录结构标准清单等关键文档，确保文档与代码实现同步，为项目维护与后续开发提供准确资料。

### 6. 更新任务状态

在看板或任务管理工具中及时更新任务状态，标注任务进度与完成情况，便于团队成员了解项目整体进展。

### 7. 运行自检脚本

执行`finish.py` `--self - check`脚本进行工作结束自检，按脚本提示处理检查结果，确保工作完整性与规范性。

### 8. 目录结构合规性检查

每次工作结束时，由`finish.py`脚本执行以下操作：

{{ PROJECT_ROOT }}/project
2.  自动生成含违规项的检查报告。
    *   报告生成位置：`{{paths.logs_dir}}\{{structure_check.report_dir}}\`
    *   报告命名格式：`检查报告_YYYYMMDD - HHMMSS.md`

3.  调用`agent_verify_structure`函数暂停脚本执行；

4.  通过 TaskManager 创建审批任务；

5.  人工处理违规项后，若项目结构发生变更，再次运行`update_structure.py`更新目录结构标准清单。

## 五、GitHub 仓库结构规范

### 1. 仓库主要文件夹

*   `\docs`：存放项目相关文档，包括设计文档、用户手册等。
*   `\project`：存放项目代码，按功能模块或技术架构组织。
*   `\tools`：存放项目开发过程中使用的工具脚本。
*   `\data`：存放项目数据文件，包括数据库文件、上传文件、导出文件等（开发环境核心组成部分）。
*   `\docker`：存放Docker容器化配置文件，包括docker-compose.yml、Dockerfile等（开发环境核心组成部分）。

### 2. 提交规范

*   所有代码提交和版本控制遵循上述仓库结构规范，保证项目文件组织清晰、层次分明。
*   本地`\bak`和`\logs`目录内容不得推送到 Git 仓库，确保仓库内容规范性。
*   `\data`和`\docker`目录作为开发环境核心组成部分，必须纳入版本控制、GitHub同步维护和全量备份范围。

### 3. bak和logs目录特殊处理规范

#### 3.1 目录结构管理
*   **bak目录**：必须保持标准子目录结构（github_repo/、专项备份/、迁移备份/、待清理资料/、常规备份/），但具体文件内容不纳入版本控制
*   **logs目录**：必须保持标准子目录结构（archive/、其他日志/、工作记录/、检查报告/），但具体文件内容不纳入版本控制

#### 3.2 版本控制规则
*   Git提交时：只提交目录结构，排除所有具体文件内容
*   GitHub推送时：只推送目录结构，排除所有具体文件内容
*   系统全量备份时：只备份目录结构，排除所有具体文件内容

#### 3.3 .gitignore配置要求
**重要提醒**：.gitignore文件必须放置在 `{{paths.backup_dir}}\github_repo\.gitignore` 位置，不得放在项目根目录下。

确保该.gitignore文件包含以下规则：
```
# 排除bak目录的具体文件，保留目录结构
bak\**\*
!bak\
!bak\github_repo\
!bak\专项备份\
!bak\迁移备份\
!bak\待清理资料\

# 排除logs目录的具体文件，保留目录结构
logs/**/*
!logs/
!logs/archive/
!logs/其他日志/
!logs/工作记录/
!logs/检查报告/

```

## 六、目录文件及清单管理规定

### 1. 目录结构标准清单

*   存放位置：`{{paths.docs_dir}}\01-设计\{{structure_check.standard_list_file}}`
*   清单涵盖内容：
    *   `\bak`文件夹及其子文件夹（共 5 个），不包含具体文件；
    *   `\logs`文件夹，不包含具体文件；
    *   `\docs`文件夹及其所有内容；
    *   `\project`文件夹及其所有内容；
    *   `\tools`文件夹及其所有内容；
    *   `\data`文件夹及其所有内容；
    *   `\docker`文件夹及其所有内容。

### 2. 特殊目录管理

*   **\bak 目录**：用于本地备份，其下子文件夹（如 "github_repo"、"迁移备份"、"专项备份"、"待清理资料" 和 "常规备份"）仅保留在本地，不推送到 Git 仓库。
*   **\bak\github_repo 目录**：专门用于 Git 仓库，包含`docs`、`project`、`tools`、`data`和`docker`五个子文件夹，需符合 GitHub 仓库结构规范。
*   **\logs 目录**：用于存放日志文件，内容不包含在目录结构标准清单中，也不推送到 Git 仓库。
*   **\data 目录**：存放项目数据文件，包括数据库文件、上传文件、导出文件等，作为开发环境核心组成部分，必须纳入同步维护、全量备份和GitHub上传范围。
*   **\docker 目录**：存放Docker容器化配置文件，包括docker-compose.yml、Dockerfile等，作为开发环境核心组成部分，必须纳入同步维护、全量备份和GitHub上传范围。

### 3. 目录结构更新工具

`update_structure.py`使用规范：
*   在生成目录结构标准清单时，自动排除`\bak`和`\logs`目录内容；
*   包含`\data`和`\docker`目录的完整内容结构；
*   仅保留目录本身，不包含具体文件，工具已配置好相关排除规则。

### 4. 全量备份和GitHub上传范围

#### 4.1 全量备份内容
*   `\docs`：项目文档（完整内容）
*   `\project`：项目代码（完整内容）
*   `\tools`：开发工具（完整内容）
*   `\data`：项目数据文件（完整内容）
*   `\docker`：Docker配置文件（完整内容）
*   `\AI调度表`：AI调度成果（完整内容）

#### 4.2 GitHub上传内容
*   `\docs`：项目文档（完整内容）
*   `\project`：项目代码（完整内容）
*   `\tools`：开发工具（完整内容）
*   `\data`：项目数据文件（完整内容）
*   `\docker`：Docker配置文件（完整内容）

#### 4.3 排除内容
*   `\bak`：备份目录（仅保留目录结构，排除具体文件）
*   `\logs`：日志目录（仅保留目录结构，排除具体文件）
*   `\temp`：临时文件目录
*   `\uploads`：上传文件目录（根据需要选择性备份）

## 七、命名规范

### 1. 通用原则

*   **清晰性**：命名清晰表达元素含义或用途，避免模糊或过于简略缩写。
*   **一致性**：整个项目中，同类元素命名风格保持统一。
*   **简洁性**：在保证清晰表意前提下，命名尽量简洁。
*   **英文为主**：代码中的标识符（变量、函数、类、文件名、目录名等）原则上使用英文，特定配置文件或文档明确要求使用中文的情况除外。

### 2. 具体命名规则

| 元素类型                           | 命名规范                                               | 示例                                          |
| ----------------------------------- | ------------------------------------------------------- | ------------------------------------------------ |
| 目录                             | 小写字母和下划线（snake_case）；层级或分类目录可用短横线（kebab - case）分隔 | src、utils、01 - 设计                           |
| 代码文件（Python）                   | 小写字母和下划线（snake_case）                              | data_loader.py、api_service.py             |
| 文档文件（Markdown）                 | 中文命名，用下划线或短横线分隔                                    | 项目架构设计.md、数据库 ER 图.md                       |
| 配置文件                           | 小写字母，可包含点（.）和下划线（_）                               | .env、config.yaml、settings_production.py    |
| 变量（Python）                     | 小写字母和下划线（snake_case）                              | user_name、total_count                     |
| 常量                             | 全大写字母和下划线                                          | MAX_RETRIES、DEFAULT_TIMEOUT               |
| 函数 / 方法（Python）                | 小写字母和下划线（snake_case）                              | get_user_data()、calculate_total_price() |
| 类（Python）                      | 大驼峰式（PascalCase）                                   | UserService、DatabaseConnection              |
| 数据库表名和字段名                      | 小写字母和下划线（snake_case）                              | users（表名）、user_id、created_at（字段名）         |

### 3. 注意事项

*   本规范为通用指导，若特定框架或库有自身命名约定，优先遵循其规定。

## 八、开发流程规范

### 四阶段开发计划

根据项目架构设计，开发工作分为四个阶段：

#### 第一阶段：基础架构搭建（2周）
**目标**：建立项目基础架构和开发环境
**交付物**：
- 项目目录结构建立
- 开发环境配置
- 基础技术栈搭建
- 数据库设计和初始化
- 基础API框架

#### 第二阶段：核心功能开发（6周）
**目标**：实现PMC核心业务功能
**交付物**：
- 订单管理模块
- 生产计划模块
- 物料管理模块
- 进度跟踪模块
- 基础图表界面
- Excel兼容性支持

#### 第三阶段：图表界面优化（4周）
**目标**：完善图表界面和用户体验
**交付物**：
- 高级图表组件
- 响应式界面设计
- 移动端适配
- 用户交互优化
- 性能优化

#### 第四阶段：集成测试部署（2周）
**目标**：系统集成、测试和部署上线
**交付物**：
- 通知催办系统集成
- 系统集成测试
- 用户验收测试
- 部署文档
- 用户培训材料

### Git 工作流程

#### 分支管理
- `main`: 主分支，保持稳定可发布状态
- `develop`: 开发分支，集成最新开发功能
- `feature/*`: 功能分支，开发新功能
- `hotfix/*`: 热修复分支，紧急修复生产问题
- `release/*`: 发布分支，准备新版本发布

#### 提交规范
```
<type>(<scope>): <subject>

<body>

<footer>
```

**类型说明**:
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具变动

**示例**:
```
feat(scheduling): 添加自动排程功能

- 实现LSTM预测算法
- 集成遗传优化
- 添加实时监控

Closes #123
```

### 代码审查

#### 审查要点
- 代码逻辑正确性
- 代码风格一致性
- 性能影响评估
- 安全性检查
- 测试覆盖率

#### 审查流程
1. 开发者创建Pull Request
2. 自动化检查（CI/CD）
3. 同行代码审查
4. 技术负责人最终审查
5. 合并到目标分支

## 九、开发环境规范

### 环境要求

#### 基础环境
- Python >= 3.11 (后端开发语言)
- Node.js >= 18.0.0 (前端开发环境)
- Docker >= 20.0 (容器化开发)
- Git >= 2.30 (版本控制)
- Windows 10/11 (目标运行环境)

#### 数据存储环境
- PostgreSQL >= 15 (主数据库)
- Redis >= 7.0 (缓存和会话存储)

#### 前后端技术栈
- FastAPI (后端API框架)
- React 18 (前端框架)
- TypeScript (类型安全的JavaScript)
- Ant Design 5.x (UI组件库)
- ECharts (图表可视化库)
- Vite (前端构建工具)

#### 开发工具
- VS Code + Dev Container支持
- Docker Desktop
- Python虚拟环境管理

### 编辑器配置

#### VS Code 推荐插件
```json
{
  "recommendations": [
    "esbenp.prettier-vscode",
    "ms-python.python",
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "ms-vscode-remote.remote-containers"
  ]
}
```

#### EditorConfig
```ini
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true
indent_style = space
indent_size = 4

[*.md]
trim_trailing_whitespace = false
```

### 依赖管理

#### Node.js项目
- 使用 `package-lock.json` 锁定依赖版本
- 定期更新依赖，检查安全漏洞
- 区分 `dependencies` 和 `devDependencies`

#### Python项目
- 使用 `requirements.txt` 管理依赖
- 使用虚拟环境隔离项目依赖
- 固定依赖版本号
- 集成AI框架依赖

#### 代码质量工具配置

**Python后端工具**：
- **flake8**: Python代码风格检查
- **black**: Python代码格式化
- **mypy**: Python类型检查
- **pytest**: Python单元测试框架
- **coverage**: 测试覆盖率分析
- **bandit**: Python安全性检查
- **isort**: Python导入排序

**前端工具**：
- **ESLint**: JavaScript/TypeScript代码检查
- **Prettier**: 代码格式化
- **TypeScript**: 类型检查
- **Jest**: 单元测试框架
- **React Testing Library**: React组件测试
- **Cypress**: 端到端测试
- **Stylelint**: CSS/Less样式检查

## 十、代码规范

### 命名规范

#### 变量命名
```python
# Python - snake_case
user_name = "张三"
total_count = 100
is_active = True
```

#### 函数命名
```python
# Python
def get_user_info(user_id):
    pass

def calculate_total_price(items):
    pass
```

### 代码风格

遵循PEP8标准，使用Black自动格式化。

### 注释规范

- 函数/类: Docstring格式
- 行内注释: 解释复杂逻辑
- TODO注释: 标记待办事项

## 十一、测试规范

### 测试策略
- **单元测试**：覆盖率 >= 80%
- **集成测试**：API接口和数据库交互
- **组件测试**：React组件独立测试
- **端到端测试**：完整业务流程
- **性能测试**：页面加载 < 3秒，API响应 < 1秒
- **兼容性测试**：Excel导入导出功能

### 前端测试框架
- **Jest**：单元测试和集成测试
- **React Testing Library**：React组件测试
- **Cypress**：端到端测试
- **MSW (Mock Service Worker)**：API模拟

### 后端测试框架
- **pytest**：Python单元测试和集成测试
- **FastAPI TestClient**：API测试
- **pytest-asyncio**：异步测试支持
- **factory_boy**：测试数据工厂

### 测试结构
```
tests/
├── frontend/
│   ├── unit/           # 前端单元测试
│   ├── components/     # 组件测试
│   ├── integration/    # 前端集成测试
│   └── e2e/           # 端到端测试
├── backend/
│   ├── unit/           # 后端单元测试
│   ├── integration/    # API集成测试
│   └── fixtures/       # 测试数据
└── shared/
    └── data/          # 共享测试数据
```

### PMC业务测试重点
- **订单管理流程**：创建、更新、状态变更
- **生产计划算法**：排程逻辑和优化
- **图表数据准确性**：数据计算和展示
- **Excel兼容性**：导入导出功能
- **通知催办机制**：多渠道消息发送
- **权限控制**：角色和访问权限

### 覆盖率要求

- 整体覆盖率 > 80%
- 核心模块 > 90%

## 十二、配置管理规范

### 配置文件位置规范

#### 环境配置文件统一存放位置
所有环境配置文件必须统一存放在 `project/` 目录下，禁止在项目根目录存放环境配置文件：

- **`project/.env`**：默认环境配置文件，用于本地开发
- **`project/.env.example`**：环境配置模板，包含所有配置项说明
- **`project/.env.sqlserver`**：SQL Server数据库环境配置
- **`project/.env.development`**：开发环境专用配置
- **`project/.env.testing`**：测试环境专用配置
- **`project/.env.production`**：生产环境专用配置

#### 配置加载优先级
1. 环境变量（最高优先级）
2. 特定环境配置文件（如 `.env.production`）
3. 默认配置文件（`.env`）
4. 系统默认值（最低优先级）

### 环境配置
- **开发环境（development）**：本地开发配置，使用本地数据库
- **测试环境（testing）**：集成测试配置，使用测试数据库
- **预生产环境（staging）**：生产环境镜像，用于最终验证
- **生产环境（production）**：线上部署配置，高可用配置

### 前端配置管理
- **Vite环境变量**：使用`.env`文件系列
- **构建配置**：不同环境的构建参数
- **API端点配置**：后端服务地址配置
- **图表主题配置**：ECharts主题和样式配置

### 后端配置管理
- **FastAPI设置**：使用Pydantic Settings
- **数据库配置**：PostgreSQL连接参数
- **Redis配置**：缓存和会话存储配置
- **第三方集成**：微信API、邮件服务等配置

### 配置文件格式
- **前端**：使用`.env`文件和TypeScript配置
- **后端**：使用YAML格式和环境变量
- **Docker**：使用docker-compose.yml
- **敏感信息**：使用环境变量和密钥管理

### 数据库配置

#### 数据库类型支持
- **PostgreSQL**：默认数据库，适用于生产环境，使用 `.env` 配置
- **SQL Server**：企业级数据库支持，使用 `.env.sqlserver` 配置
- **SQLite**：轻量级数据库，适用于开发和测试环境

#### SQL Server配置要求
使用 `project/.env.sqlserver` 文件进行SQL Server环境配置：
- 必须包含完整的连接参数（主机、端口、数据库名、认证信息）
- 支持Windows认证和SQL Server认证两种方式
- 包含连接池配置和超时设置
- 提供ODBC驱动配置说明

#### 通用数据库配置
- **连接池配置**：最大连接数、超时设置
- **备份策略**：定期备份和恢复机制
- **性能优化**：索引策略和查询优化
- **数据迁移**：Alembic版本管理

### 环境变量管理
- **开发环境**：使用 `project/.env` 文件
- **生产环境**：系统环境变量
- **密钥管理**：定期轮换和安全存储
- **配置验证**：启动时配置检查机制

### 安全配置原则
- **敏感信息保护**：密码、密钥、API Token等敏感信息不得提交到版本控制
- **配置模板**：使用 `project/.env.example` 提供配置模板和说明
- **生产环境安全**：生产环境配置通过环境变量或安全的配置管理系统注入
- **权限控制**：配置文件访问权限严格控制，仅授权人员可访问
- **配置审计**：定期审查配置文件内容，确保符合安全要求

### PMC业务配置
- **Excel服务器配置**：勤哲Excel Server连接参数
- **通知渠道配置**：微信、邮件、短信服务配置
- **业务规则配置**：生产计划算法参数
- **报表配置**：图表样式和数据源配置

## 十三、API设计规范

### RESTful API设计

- 使用标准HTTP方法（GET, POST, PUT, DELETE, PATCH）
- 资源命名使用复数形式，符合PMC业务领域
- 统一的响应格式，支持图表数据结构
- 适当的HTTP状态码和错误信息
- 支持分页、排序、筛选等查询参数

### PMC业务API设计

- **订单管理API**：`/api/v1/orders/`
- **生产计划API**：`/api/v1/production-plans/`
- **物料管理API**：`/api/v1/materials/`
- **进度跟踪API**：`/api/v1/progress/`
- **图表数据API**：`/api/v1/charts/`
- **通知催办API**：`/api/v1/notifications/`

### 版本控制

- URL版本控制：`/api/v1/`
- 向后兼容性保证
- 版本废弃通知机制
- 支持多版本并存

### 认证授权

- JWT Token认证
- 基于角色的访问控制（RBAC）
- API密钥管理
- 支持企业微信集成认证

### 数据格式规范

- 统一使用JSON格式
- 时间格式使用ISO 8601标准
- 数值精度保持一致
- 支持Excel数据导入导出格式

### 监控日志

- API调用日志记录
- 性能监控和响应时间统计
- 错误追踪和异常处理
- 业务操作审计日志

---

## 总结

本规范文档基于PMC全流程图表界面应用软件的项目定位，建立了完整的开发管理体系。核心要点包括：

### 项目特色
- **图表界面优先**：以可视化图表为核心的用户界面设计
- **PMC全流程覆盖**：从订单到交付的完整业务流程支持
- **Excel兼容性**：与勤哲Excel Server的深度集成
- **多渠道催办**：微信、邮件、短信的智能通知系统

### 技术架构
- **前后端分离**：React + TypeScript前端，FastAPI + Python后端
- **现代化技术栈**：采用最新稳定版本的主流技术
- **数据驱动**：以PostgreSQL为主数据库，Redis为缓存
- **容器化部署**：Docker容器化开发和部署

### 开发流程
- **四阶段开发**：基础架构 → 核心功能 → 界面优化 → 集成部署
- **角色明确**：技术负责人、前端开发者、后端开发者、全栈开发者
- **质量保证**：完整的测试体系和代码质量控制
- **规范统一**：统一的编码规范、API设计和配置管理

### 业务价值
- **提升效率**：通过可视化界面和自动化催办提升PMC工作效率
- **降低成本**：减少人工跟踪和沟通成本
- **增强协作**：多部门统一工作平台，提升协作效率
- **数据驱动**：基于数据的决策支持和业务优化

本规范将随着项目进展持续更新和完善，确保开发工作的有序进行和项目目标的顺利实现。
